(()=>{var t={n:s=>{var a=s&&s.__esModule?()=>s.default:()=>s;return t.d(a,{a}),a},d:(s,a)=>{for(var e in a)t.o(a,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:a[e]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s)};(()=>{"use strict";const s=flarum.core.compat["forum/app"];var a=t.n(s);const e=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/components/DiscussionListItem"];var o=t.n(r);flarum.core.compat["common/models/Discussion"];const i=flarum.core.compat["common/helpers/avatar"];var n=t.n(i);const u=flarum.core.compat["common/helpers/icon"];var c=t.n(u);const l=flarum.core.compat["common/utils/abbreviateNumber"];var d=t.n(l);const f=flarum.core.compat["common/utils/stringToColor"];var p=t.n(f);a().initializers.add("custom/discussions-item",function(){console.log("custom/discussions-item"),(0,e.extend)(o().prototype,"contentItems",function(t){t.add("enhancedInfo",this.enhancedInfoView(),5),console.log("items",t),console.log("this.attrs.discussion",this.attrs)}),(0,e.extend)(o().prototype,"infoItems",function(t){console.log("items",t),t.add("authorAvatar",this.authorAvatarView(),1)}),(0,e.extend)(o().prototype,"view",function(t){void 0!==a().forum.attribute("fof-discussion-thumbnail.link_to_discussion")&&(this.hasDiscussionThumbnail=!0)}),o().prototype.authorAvatarView=function(){var t=this.attrs.discussion,s=!1!==a().forum.attribute("custom-discussions-item.enable_author_avatar"),e=parseInt(a().forum.attribute("custom-discussions-item.avatar_size"))||24;if(!s)return null;var r=t.user?t.user():null;if(!r)return null;var o=this.hasDiscussionThumbnail||void 0!==a().forum.attribute("fof-discussion-thumbnail.link_to_discussion");return m("div",{className:"DiscussionListItem-author-avatar "+(o?"with-thumbnail":"")},n()(r,{size:e,className:o?"custom-avatar":""}))},o().prototype.enhancedInfoView=function(){this.attrs.discussion;var t=!1!==a().forum.attribute("custom-discussions-item.enable_likes_count"),s=!1!==a().forum.attribute("custom-discussions-item.enable_reply_avatars");return t||s?m("div",{className:"DiscussionListItem-enhanced"},m("div",{className:"DiscussionListItem-likes"},this.likesInfoView()),m("div",{className:"DiscussionListItem-reply-avatars"},this.replyAvatarsView())):null},o().prototype.likesInfoView=function(){var t=this.attrs.discussion;if(!1===a().forum.attribute("custom-discussions-item.enable_likes_count"))return null;var s=t.data.attributes.likesCount||0;return m("span",{className:"likes-count"},c()("fas fa-heart"),m("span",{className:"count"},a().translator.trans("custom-discussions-item.forum.likes_count",{count:d()(s)})))},o().prototype.replyAvatarsView=function(){var t=this.attrs.discussion,s=!1!==a().forum.attribute("custom-discussions-item.enable_reply_avatars"),e=parseInt(a().forum.attribute("custom-discussions-item.max_reply_avatars"))||5,r=parseInt(a().forum.attribute("custom-discussions-item.avatar_size"))||20;if(console.log("回帖头像配置读取:",{enableReplyAvatars:s,maxAvatars:e,avatarSize:r}),!s)return null;var o=t.data.attributes.replyUsers||[];if(0===o.length)return null;console.log("显示回帖用户头像，数量:",o.length);var i=o.slice(0,e);return m("div",null,m("span",{className:"reply-avatars-label"},a().translator.trans("custom-discussions-item.forum.recent_replies"),":"),m("div",{className:"avatars-list"},i.map(function(t,s){var a={id:function(){return t.id},username:function(){return t.username},displayName:function(){return t.displayName||t.username},avatarUrl:function(){return t.avatarUrl},color:function(){if(t.avatarUrl)return"";var s=t.displayName||t.username;return"#"+p()(s)}};return m("span",{key:s,className:"reply-avatar",title:t.displayName||t.username},n()(a,{size:r}))}),o.length>e&&m("span",{className:"more-avatars",title:a().translator.trans("custom-discussions-item.forum.more_replies",{count:o.length-e})},a().translator.trans("custom-discussions-item.forum.more_replies",{count:o.length-e}))))}})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map